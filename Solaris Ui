--[[
    Solaris UI Library V2
    "Perfected for Mobile & PC"
    
    Fixed based on QA Report:
    - Standardized 8px corners
    - Quart/Out Easing for premium feel
    - Global Input Handling for Sliders
    - Dynamic Canvas Resizing (No clipping)
    - Full Key System Support
    
    Usage:
    local Solaris = loadstring(game:HttpGet("..."))()
    
    local Window = Solaris:CreateWindow({
        Name = "Solaris Hub",
        KeySystem = true,
        KeySettings = {
            Title = "Solaris Key System",
            Subtitle = "Link in Discord",
            Note = "Join dsc.gg/solaris",
            FileName = "SolarisKey",
            SaveKey = true,
            GrabKeyFromSite = false, -- If true, Key must be a URL
            Key = "1234" -- The actual key
        }
    })
]]

local Solaris = {}

-- Services
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = game:GetService("Players").LocalPlayer
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

-- Parent Determination
local Parent = nil
if pcall(function() return CoreGui.Name end) then
    Parent = CoreGui
else
    Parent = LocalPlayer:WaitForChild("PlayerGui")
end

-- Theme & Settings
local Theme = {
    Background = Color3.fromRGB(15, 15, 20), -- Darker, sleeker
    Sidebar = Color3.fromRGB(20, 20, 25),
    Element = Color3.fromRGB(25, 25, 30),
    Text = Color3.fromRGB(240, 240, 240),
    SubText = Color3.fromRGB(170, 170, 170), -- Brightened for accessibility
    Accent = Color3.fromRGB(0, 140, 255), -- "Rayfield Blue"
    Outline = Color3.fromRGB(40, 40, 45),
    Shadow = Color3.fromRGB(0, 0, 0)
}

local TweenInfoDefault = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)

-- Utility Functions
local function Tween(obj, props, customInfo)
    TweenService:Create(obj, customInfo or TweenInfoDefault, props):Play()
end

local function MakeDraggable(topbarobject, object)
    local Dragging = nil
    local DragInput = nil
    local DragStart = nil
    local StartPosition = nil

    topbarobject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPosition = object.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)

    topbarobject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            local Delta = input.Position - DragStart
            local newPos = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
            Tween(object, {Position = newPos}, TweenInfo.new(0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out))
        end
    end)
end

-- Cleanup Table (Maid)
local Connections = {}

function Solaris:Destroy()
    for _, conn in pairs(Connections) do
        conn:Disconnect()
    end
    if Parent:FindFirstChild("SolarisMain") then
        Parent.SolarisMain:Destroy()
    end
end

-- Main Window Creation
function Solaris:CreateWindow(Settings)
    local WindowName = Settings.Name or "Solaris UI"
    local KeySystem = Settings.KeySystem or false
    local KeySettings = Settings.KeySettings or {}
    
    -- Main ScreenGui
    if Parent:FindFirstChild("SolarisMain") then Parent.SolarisMain:Destroy() end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "SolarisMain"
    ScreenGui.Parent = Parent
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    
    -- Protect GUI
    if syn and syn.protect_gui then syn.protect_gui(ScreenGui) end

    -------------------------------------------------------------------------
    -- KEY SYSTEM LOGIC
    -------------------------------------------------------------------------
    if KeySystem then
        local Validated = false
        
        local KeyFrame = Instance.new("Frame")
        KeyFrame.Name = "KeyFrame"
        KeyFrame.Parent = ScreenGui
        KeyFrame.BackgroundColor3 = Theme.Background
        KeyFrame.Size = UDim2.new(0, 400, 0, 250)
        KeyFrame.Position = UDim2.new(0.5, -200, 0.5, -125)
        KeyFrame.BorderSizePixel = 0
        
        local KeyCorner = Instance.new("UICorner")
        KeyCorner.CornerRadius = UDim.new(0, 8)
        KeyCorner.Parent = KeyFrame
        
        local KeyStroke = Instance.new("UIStroke")
        KeyStroke.Color = Theme.Outline
        KeyStroke.Thickness = 1
        KeyStroke.Parent = KeyFrame
        
        local KeyTitle = Instance.new("TextLabel")
        KeyTitle.Parent = KeyFrame
        KeyTitle.BackgroundTransparency = 1
        KeyTitle.Position = UDim2.new(0, 0, 0, 20)
        KeyTitle.Size = UDim2.new(1, 0, 0, 30)
        KeyTitle.Font = Enum.Font.GothamBold
        KeyTitle.Text = KeySettings.Title or "Key System"
        KeyTitle.TextColor3 = Theme.Text
        KeyTitle.TextSize = 22
        
        local KeyInput = Instance.new("TextBox")
        KeyInput.Parent = KeyFrame
        KeyInput.BackgroundColor3 = Theme.Element
        KeyInput.Position = UDim2.new(0.1, 0, 0.4, 0)
        KeyInput.Size = UDim2.new(0.8, 0, 0, 40)
        KeyInput.Font = Enum.Font.Gotham
        KeyInput.PlaceholderText = "Enter Key..."
        KeyInput.Text = ""
        KeyInput.TextColor3 = Theme.Text
        KeyInput.PlaceholderColor3 = Theme.SubText
        KeyInput.TextSize = 14
        
        local InputCorner = Instance.new("UICorner")
        InputCorner.CornerRadius = UDim.new(0, 8)
        InputCorner.Parent = KeyInput
        
        local CheckBtn = Instance.new("TextButton")
        CheckBtn.Parent = KeyFrame
        CheckBtn.BackgroundColor3 = Theme.Accent
        CheckBtn.Position = UDim2.new(0.1, 0, 0.65, 0)
        CheckBtn.Size = UDim2.new(0.8, 0, 0, 35)
        CheckBtn.Font = Enum.Font.GothamBold
        CheckBtn.Text = "Check Key"
        CheckBtn.TextColor3 = Theme.Text
        CheckBtn.TextSize = 14
        
        local BtnCorner = Instance.new("UICorner")
        BtnCorner.CornerRadius = UDim.new(0, 8)
        BtnCorner.Parent = CheckBtn
        
        -- Saved Key Loading
        if KeySettings.SaveKey and isfile and isfile(KeySettings.FileName .. ".txt") then
            KeyInput.Text = readfile(KeySettings.FileName .. ".txt")
        end

        local function Check()
            local Entered = KeyInput.Text
            local ActualKey = KeySettings.Key
            
            if KeySettings.GrabKeyFromSite then
               -- Simple example, in production use pcall
               ActualKey = game:HttpGet(KeySettings.Key)
            end
            
            if Entered == ActualKey then
                if KeySettings.SaveKey and writefile then
                    writefile(KeySettings.FileName .. ".txt", Entered)
                end
                Tween(KeyFrame, {Size = UDim2.new(0, 0, 0, 0), Transparency = 1})
                wait(0.2)
                KeyFrame.Visible = false
                Validated = true
            else
                KeyInput.Text = "Incorrect Key"
                wait(1)
                KeyInput.Text = ""
            end
        end
        
        CheckBtn.MouseButton1Click:Connect(Check)
        
        -- Hold thread until key is validated
        repeat wait() until Validated
    end

    -------------------------------------------------------------------------
    -- MAIN LIBRARY STRUCTURE
    -------------------------------------------------------------------------

    local Library = {Tabs = {}}

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Theme.Background
    MainFrame.Position = UDim2.new(0.5, -290, 0.5, -190) -- Slightly larger for modern feel
    MainFrame.Size = UDim2.new(0, 580, 0, 380)
    MainFrame.ClipsDescendants = true 
    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 8)
    MainCorner.Parent = MainFrame
    
    local MainStroke = Instance.new("UIStroke")
    MainStroke.Color = Theme.Outline
    MainStroke.Thickness = 1
    MainStroke.Parent = MainFrame

    -- Sidebar (Tabs)
    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Parent = MainFrame
    Sidebar.BackgroundColor3 = Theme.Sidebar
    Sidebar.Size = UDim2.new(0, 160, 1, 0)
    Sidebar.BorderSizePixel = 0
    
    local SideCorner = Instance.new("UICorner")
    SideCorner.CornerRadius = UDim.new(0, 8)
    SideCorner.Parent = Sidebar
    
    -- Fix corner overlap
    local SideCover = Instance.new("Frame")
    SideCover.Parent = Sidebar
    SideCover.BackgroundColor3 = Theme.Sidebar
    SideCover.BorderSizePixel = 0
    SideCover.Size = UDim2.new(0, 10, 1, 0)
    SideCover.Position = UDim2.new(1, -10, 0, 0)
    
    local SidebarStroke = Instance.new("UIStroke") -- Separator line
    SidebarStroke.Color = Theme.Outline
    SidebarStroke.Thickness = 1
    SidebarStroke.Parent = Sidebar
    
    -- Title
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Parent = Sidebar
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Position = UDim2.new(0, 15, 0, 20)
    TitleLabel.Size = UDim2.new(1, -30, 0, 30)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.Text = WindowName
    TitleLabel.TextColor3 = Theme.Accent
    TitleLabel.TextSize = 18
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local TabContainer = Instance.new("ScrollingFrame")
    TabContainer.Parent = Sidebar
    TabContainer.BackgroundTransparency = 1
    TabContainer.Position = UDim2.new(0, 0, 0, 70)
    TabContainer.Size = UDim2.new(1, 0, 1, -70)
    TabContainer.ScrollBarThickness = 0
    
    local TabList = Instance.new("UIListLayout")
    TabList.Parent = TabContainer
    TabList.SortOrder = Enum.SortOrder.LayoutOrder
    TabList.Padding = UDim.new(0, 6)
    
    local TabPadding = Instance.new("UIPadding")
    TabPadding.Parent = TabContainer
    TabPadding.PaddingLeft = UDim.new(0, 10)
    TabPadding.PaddingTop = UDim.new(0, 10)

    -- Content Area
    local ContentArea = Instance.new("Frame")
    ContentArea.Name = "ContentArea"
    ContentArea.Parent = MainFrame
    ContentArea.BackgroundTransparency = 1
    ContentArea.Position = UDim2.new(0, 170, 0, 10)
    ContentArea.Size = UDim2.new(0, 400, 1, -20)
    ContentArea.ClipsDescendants = true
    
    -- Top Bar for Dragging
    local DragBar = Instance.new("Frame")
    DragBar.Parent = MainFrame
    DragBar.BackgroundTransparency = 1
    DragBar.Size = UDim2.new(1, 0, 0, 40)
    MakeDraggable(DragBar, MainFrame)
    
    -------------------------------------------------------------------------
    -- TAB GENERATION
    -------------------------------------------------------------------------
    function Library:CreateTab(TabName)
        local Tab = {Items = {}}
        
        -- Tab Button
        local TabBtn = Instance.new("TextButton")
        TabBtn.Parent = TabContainer
        TabBtn.BackgroundColor3 = Theme.Sidebar
        TabBtn.Size = UDim2.new(1, -20, 0, 32)
        TabBtn.Font = Enum.Font.GothamBold
        TabBtn.Text = "  " .. TabName
        TabBtn.TextColor3 = Theme.SubText
        TabBtn.TextSize = 13
        TabBtn.TextXAlignment = Enum.TextXAlignment.Left
        TabBtn.AutoButtonColor = false
        
        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(0, 6)
        TabCorner.Parent = TabBtn
        
        -- Tab Page
        local Page = Instance.new("ScrollingFrame")
        Page.Name = TabName .. "Page"
        Page.Parent = ContentArea
        Page.BackgroundTransparency = 1
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = Theme.SubText
        Page.Visible = false
        Page.CanvasSize = UDim2.new(0, 0, 0, 0)
        
        local PageList = Instance.new("UIListLayout")
        PageList.Parent = Page
        PageList.SortOrder = Enum.SortOrder.LayoutOrder
        PageList.Padding = UDim.new(0, 10)
        
        local PagePad = Instance.new("UIPadding")
        PagePad.Parent = Page
        PagePad.PaddingTop = UDim.new(0, 5)
        PagePad.PaddingRight = UDim.new(0, 5)
        PagePad.PaddingLeft = UDim.new(0, 1)

        -- Dynamic Canvas Resizing (Fix for Clipping)
        PageList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageList.AbsoluteContentSize.Y + 20)
        end)
        
        -- Tab Selection Logic
        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(TabContainer:GetChildren()) do
                if v:IsA("TextButton") then
                    Tween(v, {TextColor3 = Theme.SubText, BackgroundTransparency = 1})
                end
            end
            for _, v in pairs(ContentArea:GetChildren()) do
                if v:IsA("ScrollingFrame") then v.Visible = false end
            end
            
            Tween(TabBtn, {TextColor3 = Theme.Accent, BackgroundTransparency = 0.9}) -- Subtle Highlight
            Page.Visible = true
        end)
        
        -- Select First Tab by default
        if #TabContainer:GetChildren() == 2 then -- 1 is Layout, 2 is First Button
            TabBtn.TextColor3 = Theme.Accent
            TabBtn.BackgroundTransparency = 0.9
            Page.Visible = true
        end

        ---------------------------------------------------------------------
        -- ELEMENTS
        ---------------------------------------------------------------------

        function Tab:CreateSection(SectionName)
            local Label = Instance.new("TextLabel")
            Label.Parent = Page
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(1, 0, 0, 25)
            Label.Font = Enum.Font.GothamBold
            Label.Text = SectionName
            Label.TextColor3 = Theme.SubText
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left
        end

        function Tab:CreateButton(Settings)
            local BtnName = Settings.Name or "Button"
            local Callback = Settings.Callback or function() end
            
            local Button = Instance.new("TextButton")
            Button.Parent = Page
            Button.BackgroundColor3 = Theme.Element
            Button.Size = UDim2.new(1, 0, 0, 42)
            Button.AutoButtonColor = false
            Button.Text = ""
            
            local BtnCorner = Instance.new("UICorner")
            BtnCorner.CornerRadius = UDim.new(0, 8)
            BtnCorner.Parent = Button
            
            local BtnStroke = Instance.new("UIStroke")
            BtnStroke.Color = Theme.Outline
            BtnStroke.Thickness = 1
            BtnStroke.Parent = Button
            
            local BtnTitle = Instance.new("TextLabel")
            BtnTitle.Parent = Button
            BtnTitle.BackgroundTransparency = 1
            BtnTitle.Position = UDim2.new(0, 12, 0, 0)
            BtnTitle.Size = UDim2.new(1, -12, 1, 0)
            BtnTitle.Font = Enum.Font.GothamMedium
            BtnTitle.Text = BtnName
            BtnTitle.TextColor3 = Theme.Text
            BtnTitle.TextSize = 14
            BtnTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local Icon = Instance.new("ImageLabel")
            Icon.Parent = Button
            Icon.BackgroundTransparency = 1
            Icon.Position = UDim2.new(1, -30, 0.5, -9)
            Icon.Size = UDim2.new(0, 18, 0, 18)
            Icon.Image = "rbxassetid://6031094678" -- Generic "Pointer"
            Icon.ImageColor3 = Theme.SubText
            
            Button.MouseEnter:Connect(function()
                Tween(Button, {BackgroundColor3 = Color3.fromRGB(35, 35, 40)})
            end)
            
            Button.MouseLeave:Connect(function()
                Tween(Button, {BackgroundColor3 = Theme.Element})
            end)
            
            Button.MouseButton1Click:Connect(function()
                Tween(Button, {Size = UDim2.new(1, -4, 0, 38)})
                wait(0.05)
                Tween(Button, {Size = UDim2.new(1, 0, 0, 42)})
                Callback()
            end)
        end

        function Tab:CreateToggle(Settings)
            local ToggleName = Settings.Name or "Toggle"
            local CurrentValue = Settings.CurrentValue or false
            local Callback = Settings.Callback or function() end
            
            local ToggleBtn = Instance.new("TextButton")
            ToggleBtn.Parent = Page
            ToggleBtn.BackgroundColor3 = Theme.Element
            ToggleBtn.Size = UDim2.new(1, 0, 0, 42)
            ToggleBtn.AutoButtonColor = false
            ToggleBtn.Text = ""
            
            local TCorner = Instance.new("UICorner")
            TCorner.CornerRadius = UDim.new(0, 8)
            TCorner.Parent = ToggleBtn
            
            local TStroke = Instance.new("UIStroke")
            TStroke.Color = Theme.Outline
            TStroke.Thickness = 1
            TStroke.Parent = ToggleBtn
            
            local TTitle = Instance.new("TextLabel")
            TTitle.Parent = ToggleBtn
            TTitle.BackgroundTransparency = 1
            TTitle.Position = UDim2.new(0, 12, 0, 0)
            TTitle.Size = UDim2.new(1, -70, 1, 0)
            TTitle.Font = Enum.Font.GothamMedium
            TTitle.Text = ToggleName
            TTitle.TextColor3 = Theme.Text
            TTitle.TextSize = 14
            TTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            -- Switch Graphics
            local SwitchBg = Instance.new("Frame")
            SwitchBg.Parent = ToggleBtn
            SwitchBg.BackgroundColor3 = CurrentValue and Theme.Accent or Color3.fromRGB(50, 50, 55)
            SwitchBg.Position = UDim2.new(1, -50, 0.5, -10)
            SwitchBg.Size = UDim2.new(0, 40, 0, 20)
            
            local SwitchCorner = Instance.new("UICorner")
            SwitchCorner.CornerRadius = UDim.new(1, 0)
            SwitchCorner.Parent = SwitchBg
            
            local Circle = Instance.new("Frame")
            Circle.Parent = SwitchBg
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.Position = CurrentValue and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
            Circle.Size = UDim2.new(0, 16, 0, 16)
            
            local CCorner = Instance.new("UICorner")
            CCorner.CornerRadius = UDim.new(1, 0)
            CCorner.Parent = Circle
            
            ToggleBtn.MouseButton1Click:Connect(function()
                CurrentValue = not CurrentValue
                Callback(CurrentValue)
                
                if CurrentValue then
                    Tween(SwitchBg, {BackgroundColor3 = Theme.Accent})
                    Tween(Circle, {Position = UDim2.new(1, -18, 0.5, -8)})
                else
                    Tween(SwitchBg, {BackgroundColor3 = Color3.fromRGB(50, 50, 55)})
                    Tween(Circle, {Position = UDim2.new(0, 2, 0.5, -8)})
                end
            end)
        end

        function Tab:CreateSlider(Settings)
            local SliderName = Settings.Name or "Slider"
            local Min = Settings.Range[1] or 0
            local Max = Settings.Range[2] or 100
            local Default = Settings.CurrentValue or Min
            local Suffix = Settings.Suffix or ""
            local Callback = Settings.Callback or function() end
            
            local SliderFrame = Instance.new("Frame")
            SliderFrame.Parent = Page
            SliderFrame.BackgroundColor3 = Theme.Element
            SliderFrame.Size = UDim2.new(1, 0, 0, 60)
            
            local SCorner = Instance.new("UICorner")
            SCorner.CornerRadius = UDim.new(0, 8)
            SCorner.Parent = SliderFrame
            
            local SStroke = Instance.new("UIStroke")
            SStroke.Color = Theme.Outline
            SStroke.Thickness = 1
            SStroke.Parent = SliderFrame
            
            local STitle = Instance.new("TextLabel")
            STitle.Parent = SliderFrame
            STitle.BackgroundTransparency = 1
            STitle.Position = UDim2.new(0, 12, 0, 8)
            STitle.Size = UDim2.new(0.5, 0, 0, 20)
            STitle.Font = Enum.Font.GothamMedium
            STitle.Text = SliderName
            STitle.TextColor3 = Theme.Text
            STitle.TextSize = 14
            STitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Parent = SliderFrame
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Position = UDim2.new(0.5, 0, 0, 8)
            ValueLabel.Size = UDim2.new(0.5, -12, 0, 20)
            ValueLabel.Font = Enum.Font.Gotham
            ValueLabel.Text = tostring(Default) .. Suffix
            ValueLabel.TextColor3 = Theme.SubText
            ValueLabel.TextSize = 13
            ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
            
            local SliderBg = Instance.new("Frame")
            SliderBg.Parent = SliderFrame
            SliderBg.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            SliderBg.Position = UDim2.new(0, 12, 0, 38)
            SliderBg.Size = UDim2.new(1, -24, 0, 6)
            
            local SBgCorner = Instance.new("UICorner")
            SBgCorner.CornerRadius = UDim.new(1, 0)
            SBgCorner.Parent = SliderBg
            
            local SliderFill = Instance.new("Frame")
            SliderFill.Parent = SliderBg
            SliderFill.BackgroundColor3 = Theme.Accent
            SliderFill.Size = UDim2.new((Default - Min) / (Max - Min), 0, 1, 0)
            
            local SFCorner = Instance.new("UICorner")
            SFCorner.CornerRadius = UDim.new(1, 0)
            SFCorner.Parent = SliderFill
            
            -- Interactive Button covering the slider area
            local Interact = Instance.new("TextButton")
            Interact.Parent = SliderFrame
            Interact.BackgroundTransparency = 1
            Interact.Position = UDim2.new(0, 0, 0.5, 0)
            Interact.Size = UDim2.new(1, 0, 0.5, 0)
            Interact.Text = ""
            
            -- GLOBAL INPUT HANDLING (Fixes "Slider breaking on mouse leave")
            local Dragging = false
            
            local function Update(Input)
                local SizeX = math.clamp((Input.Position.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
                local Value = math.floor(((SizeX * (Max - Min)) + Min))
                
                Tween(SliderFill, {Size = UDim2.new(SizeX, 0, 1, 0)}, TweenInfo.new(0.05))
                ValueLabel.Text = tostring(Value) .. Suffix
                Callback(Value)
            end
            
            Interact.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = true
                    Update(Input)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = false
                end
            end)
            
            local Conn = UserInputService.InputChanged:Connect(function(Input)
                if Dragging and (Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch) then
                    Update(Input)
                end
            end)
            
            table.insert(Connections, Conn)
        end

        function Tab:CreateDropdown(Settings)
            local DropName = Settings.Name or "Dropdown"
            local Options = Settings.Options or {}
            local Default = Settings.CurrentOption or Options[1] or "Select..."
            local Callback = Settings.Callback or function() end
            
            local Dropdown = Instance.new("Frame")
            Dropdown.Parent = Page
            Dropdown.BackgroundColor3 = Theme.Element
            Dropdown.Size = UDim2.new(1, 0, 0, 42) -- Starts closed
            Dropdown.ClipsDescendants = true
            
            local DCorner = Instance.new("UICorner")
            DCorner.CornerRadius = UDim.new(0, 8)
            DCorner.Parent = Dropdown
            
            local DStroke = Instance.new("UIStroke")
            DStroke.Color = Theme.Outline
            DStroke.Thickness = 1
            DStroke.Parent = Dropdown
            
            local DTitle = Instance.new("TextLabel")
            DTitle.Parent = Dropdown
            DTitle.BackgroundTransparency = 1
            DTitle.Position = UDim2.new(0, 12, 0, 0)
            DTitle.Size = UDim2.new(1, -40, 0, 42)
            DTitle.Font = Enum.Font.GothamMedium
            DTitle.Text = DropName .. " : " .. Default
            DTitle.TextColor3 = Theme.Text
            DTitle.TextSize = 14
            DTitle.TextXAlignment = Enum.TextXAlignment.Left
            
            local DIcon = Instance.new("ImageLabel")
            DIcon.Parent = Dropdown
            DIcon.BackgroundTransparency = 1
            DIcon.Position = UDim2.new(1, -30, 0, 11)
            DIcon.Size = UDim2.new(0, 20, 0, 20)
            DIcon.Image = "rbxassetid://6031090990" -- Arrow Down
            DIcon.ImageColor3 = Theme.SubText
            
            local Interact = Instance.new("TextButton")
            Interact.Parent = Dropdown
            Interact.BackgroundTransparency = 1
            Interact.Size = UDim2.new(1, 0, 0, 42)
            Interact.Text = ""
            
            local OptionContainer = Instance.new("Frame")
            OptionContainer.Parent = Dropdown
            OptionContainer.BackgroundTransparency = 1
            OptionContainer.Position = UDim2.new(0, 0, 0, 42)
            OptionContainer.Size = UDim2.new(1, 0, 0, 0)
            
            local OptList = Instance.new("UIListLayout")
            OptList.Parent = OptionContainer
            OptList.SortOrder = Enum.SortOrder.LayoutOrder
            
            local IsOpen = false
            
            -- Refresh Function
            local function Refresh()
                for _, c in pairs(OptionContainer:GetChildren()) do
                    if c:IsA("TextButton") then c:Destroy() end
                end
                
                for _, option in pairs(Options) do
                    local OptBtn = Instance.new("TextButton")
                    OptBtn.Parent = OptionContainer
                    OptBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
                    OptBtn.BackgroundTransparency = 0.8
                    OptBtn.Size = UDim2.new(1, 0, 0, 32)
                    OptBtn.Font = Enum.Font.Gotham
                    OptBtn.Text = "  " .. option
                    OptBtn.TextColor3 = Theme.SubText
                    OptBtn.TextSize = 13
                    OptBtn.TextXAlignment = Enum.TextXAlignment.Left
                    OptBtn.AutoButtonColor = false
                    
                    OptBtn.MouseEnter:Connect(function() Tween(OptBtn, {BackgroundTransparency = 0.6}) end)
                    OptBtn.MouseLeave:Connect(function() Tween(OptBtn, {BackgroundTransparency = 0.8}) end)
                    
                    OptBtn.MouseButton1Click:Connect(function()
                        DTitle.Text = DropName .. " : " .. option
                        IsOpen = false
                        Tween(Dropdown, {Size = UDim2.new(1, 0, 0, 42)})
                        Tween(DIcon, {Rotation = 0})
                        Callback(option)
                    end)
                end
                
                OptionContainer.Size = UDim2.new(1, 0, 0, #Options * 32)
            end
            
            Refresh()
            
            Interact.MouseButton1Click:Connect(function()
                IsOpen = not IsOpen
                if IsOpen then
                    -- Dropdown PUSH Logic
                    Tween(Dropdown, {Size = UDim2.new(1, 0, 0, 42 + (#Options * 32))})
                    Tween(DIcon, {Rotation = 180})
                else
                    Tween(Dropdown, {Size = UDim2.new(1, 0, 0, 42)})
                    Tween(DIcon, {Rotation = 0})
                end
            end)
        end
        
        return Tab
    end
    
    return Library
end

return Solaris
